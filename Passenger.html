<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Select Boarding & Drop Points - Bus Booking</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .radio-custom {
            appearance: none;
            width: 20px;
            height: 20px;
            border: 2px solid #d1d5db;
            border-radius: 50%;
            position: relative;
            cursor: pointer;
        }
        .radio-custom:checked {
            border-color: #3b82f6;
            background-color: white;
        }
        .radio-custom:checked::after {
            content: '';
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: #3b82f6;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        .section-header {
            cursor: pointer;
        }
        .chevron {
            transition: transform 0.3s ease;
        }
        .chevron.rotated {
            transform: rotate(180deg);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <div class="bg-white shadow-sm p-1">
        <div class="max-w-md mx-auto px-2 py-3 flex items-center">
            <button onclick="goBack()" class="text-gray-700 text-medium mr-4">
                <i class="fas fa-arrow-left"></i>
            </button>
            <h1 class="text-medium font-semibold text-gray-800">Fill Passenger Details</h1>
        </div>
    </div>

    <div class="max-w-md mx-auto ">
        <!-- Bus Info Section -->
        <div class="p-2">
          <div class="bg-white p-2 rounded-lg">
            <div class="flex justify-between items-start">
             <div>
                <p id="bus-route" class="text-lg font-semibold text-gray-800">Route</p>
                <p class="text-sm font-semibold text-gray-700" id="bus-time">7:45 PM</p>
             </div>
             <div class="text-right">
               <h2 class="text-sm font-semibold text-gray-800" id="bus-name">Ena Transport</h2>
                <p class="text-sm text-gray-700">Type: <span class="font-medium" id="bus-type">AC</span></p>
             </div>
            </div>
          <div class="flex justify-between items-center pt-4 border-t border-gray-200">
            <span class="text-sm text-gray-600">Selected Seats: <span id="selected-seats">-</span></span>
            <span class="font-semibold text-green-800" id="total-price">₹0</span>
          </div>
          <div class="flex justify-between items-center pt-4 border-gray-200">
             <span class="text-sm text-gray-600 ">Selected Boarding & Dropping Point: <span id="selected-board-drop">-</span></span>
        
          </div>
          </div>
          
    </div>
     <!-- Passenger Details Section -->
        <div class="bg-white mx-2 rounded-lg shadow-sm mb-4">
            <div class="p-2">
                <h2 class="text-lg font-semibold text-gray-800 mb-4">Passenger details</h2>
                
                <div id="passengers-container">
                    <!-- Passenger 1 -->
                    <div class="passenger-item mb-4">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center">
                                <div class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center mr-3">
                                    <i class="fas fa-user text-green-700"></i>
                                </div>
                                <div>
                                    <p class="font-medium text-gray-800">Passenger 1</p>
                                    <p class="text-sm text-gray-500">Seat U1W, Upper Deck</p>
                                </div>
                            </div>
                            <button class="text-gray-400">
                                <i class="fas fa-chevron-up"></i>
                            </button>
                        </div>

                        <div class="space-y-3">
                            <div>
                                <input type="text" placeholder="Name *" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent">
                            </div>

                            <div>
                                <input type="number" placeholder="Age *" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent">
                            </div>

                            <div>
                                <p class="text-sm text-gray-600 mb-2">Gender *</p>
                                <div class="flex gap-3">
                                    <label class="flex-1">
                                        <input type="radio" name="gender1" value="male" class="hidden peer">
                                        <div class="px-4 py-3 border-2 border-gray-300 rounded-lg cursor-pointer peer-checked:border-orange-500 peer-checked:bg-orange-50 flex items-center justify-between">
                                            <span class="text-gray-700">Male</span>
                                            <span class="w-5 h-5 rounded-full border-2 border-gray-300 peer-checked:border-orange-500 peer-checked:bg-orange-500"></span>
                                        </div>
                                    </label>
                                    <label class="flex-1">
                                        <input type="radio" name="gender1" value="female" class="hidden peer">
                                        <div class="px-4 py-3 border-2 border-gray-300 rounded-lg cursor-pointer peer-checked:border-orange-500 peer-checked:bg-orange-50 flex items-center justify-between">
                                            <span class="text-gray-700">Female</span>
                                            <span class="w-5 h-5 rounded-full border-2 border-gray-300 peer-checked:border-orange-500 peer-checked:bg-orange-500"></span>
                                        </div>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Contact Details Section -->
        <div class="bg-white rounded-lg shadow-sm mb-4">
            <div class="p-4">
                <h2 class="text-lg font-semibold text-gray-800 mb-1">Contact details</h2>
                <p class="text-sm text-gray-500 mb-4">Ticket details will be sent to</p>

                <div class="space-y-3">
                    <div>
                        <input type="tel" placeholder="Phone *" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2  focus:border-transparent">
                    </div>
                    <div>
                        <input type="email" placeholder="Email ID" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:border-transparent">
                    </div>

                    <div class="relative">
                        <select class="w-full appearance-none px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 text-gray-700">
                            <option value="">State of Residence *</option>
                            <option value="odisha">Odisha</option>
                            <option value="west-bengal">West Bengal</option>
                            <option value="maharashtra">Maharashtra</option>
                            <option value="karnataka">Karnataka</option>
                            <option value="delhi">Delhi</option>
                        </select>
                        <i class="fas fa-chevron-down absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-500 pointer-events-none"></i>
                    </div>
                </div>
            </div>
        </div>


        <!-- Continue Button -->
        <div class="p-4">
            <button id="continue-btn" class="w-full  text-white py-3 rounded-lg font-medium disabled:bg-gray-700 disabled:cursor-not-allowed" disabled>
             Pay For Ticket
            </button>
        </div>
    </div>
   
    <script>
         function goBack() {
            window.history.back();
        }

        // Form validation
        const continueBtn = document.getElementById('continue-btn');
        const form = document.querySelector('form') || document.body;

        function validateForm() {
            const nameInput = document.querySelector('input[placeholder="Name *"]');
            const ageInput = document.querySelector('input[placeholder="Age *"]');
            const genderInputs = document.querySelectorAll('input[name="gender1"]');
            const phoneInput = document.querySelector('input[placeholder="Phone *"]');
            const stateSelect = document.querySelector('select[class*="State"]');

            const isNameFilled = nameInput && nameInput.value.trim() !== '';
            const isAgeFilled = ageInput && ageInput.value.trim() !== '';
            const isGenderSelected = Array.from(genderInputs).some(input => input.checked);
            const isPhoneFilled = phoneInput && phoneInput.value.trim() !== '';
            const isStateSelected = stateSelect && stateSelect.value !== '';

            if (isNameFilled && isAgeFilled && isGenderSelected && isPhoneFilled && isStateSelected) {
                continueBtn.disabled = false;
                continueBtn.classList.remove('bg-gray-300');
                continueBtn.classList.add('bg-orange-500');
            } else {
                continueBtn.disabled = true;
                continueBtn.classList.add('bg-gray-300');
                continueBtn.classList.remove('bg-orange-500');
            }
        }

        // Add event listeners to all form inputs
        document.querySelectorAll('input, select').forEach(element => {
            element.addEventListener('input', validateForm);
            element.addEventListener('change', validateForm);
        });

        // Book ticket button
        continueBtn.addEventListener('click', function() {
            if (!this.disabled) {
               
                // Add your booking logic here
            }
        });
       
// Load all data from URL parameters
function loadBookingData() {
    const urlParams = new URLSearchParams(window.location.search);
    
    // Get all data from URL
    const busName = urlParams.get('busName') || 'Bus Name';
    const busTime = urlParams.get('busTime') || 'Time';
    const busType = urlParams.get('busType') || 'Type';
    const selectedSeats = urlParams.get('selectedSeats') || '';
    const totalPrice = urlParams.get('totalPrice') || '0';
    const fromCity = urlParams.get('fromCity') || 'Bhubaneswar';
    const toCity = urlParams.get('toCity') || 'Cuttack';
    const boardingTime = urlParams.get('boardingTime') || '';
    const boardingLocation = urlParams.get('boardingLocation') || '';
    const droppingTime = urlParams.get('droppingTime') || '';
    const droppingLocation = urlParams.get('droppingLocation') || '';
    
    // Update bus info
    document.getElementById('bus-name').textContent = busName;
    document.getElementById('bus-time').textContent = busTime;
    document.getElementById('bus-type').textContent = busType;
    document.getElementById('selected-seats').textContent = selectedSeats || '-';
    document.getElementById('total-price').textContent = '₹' + totalPrice;
    
    // Update route - get all elements with this class/text
    const routeElements = document.querySelectorAll('#bus-route');
    routeElements.forEach(el => {
        if (el.classList.contains('text-lg')) {
            el.textContent = fromCity + ' - ' + toCity;
        } else {
            el.textContent = boardingLocation + ' - ' + droppingLocation;
        }
    });
    
    // Update boarding and dropping display
const boardDropElement = document.getElementById('selected-board-drop');
if (boardDropElement) {
    boardDropElement.textContent = `${fromCity} (${boardingTime}) → ${toCity} (${droppingTime})`;
}

    
    // Generate passenger forms based on number of seats
    generatePassengerForms(selectedSeats);
}

// Generate passenger forms dynamically
function generatePassengerForms(seatsString) {
    const seats = seatsString.split(',').map(s => s.trim()).filter(s => s);
    const container = document.getElementById('passengers-container');
    container.innerHTML = '';
    
    seats.forEach((seat, index) => {
        const passengerNumber = index + 1;
        const passengerHtml = `
            <div class="passenger-item mb-4 pb-4 ${index < seats.length - 1 ? 'border-b border-gray-200' : ''}">
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center">
                        <div class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center mr-3">
                            <i class="fas fa-user text-green-700"></i>
                        </div>
                        <div>
                            <p class="font-medium text-gray-800">Passenger ${passengerNumber}</p>
                            <p class="text-sm text-gray-500">Seat ${seat}</p>
                        </div>
                    </div>
                </div>

                <div class="space-y-3">
                    <div>
                        <input type="text" placeholder="Name *" class="passenger-input w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:border-transparent" data-passenger="${passengerNumber}">
                    </div>

                    <div>
                        <input type="number" placeholder="Age *" class="passenger-input w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:border-transparent" data-passenger="${passengerNumber}">
                    </div>

                    <div>
                        <p class="text-sm text-gray-600 mb-2">Gender *</p>
                        <div class="flex gap-3">
                          <label class="flex-1 flex items-center justify-between px-4 py-3 border-2 border-gray-300 rounded-lg cursor-pointer">
                            <input type="radio" name="gender${passengerNumber}" value="male" class="hidden peer passenger-input" data-passenger="${passengerNumber}">
                            <span class="text-gray-700">Male</span>
                            <span class="w-5 h-5 rounded-full border-2 border-gray-300 peer-checked:border-white-500 peer-checked:bg-blue-500"></span>
                          </label>

                         <label class="flex-1 flex items-center justify-between px-4 py-3 border-2 border-gray-300 rounded-lg cursor-pointer">
                           <input type="radio" name="gender${passengerNumber}" value="male" class="hidden peer passenger-input" data-passenger="${passengerNumber}">
                           <span class="text-gray-700">female</span>
                           <span class="w-5 h-5 rounded-full border-2 border-gray-300 peer-checked:border-white-500 peer-checked:bg-blue-500"></span>
                         </label>
                        </div>
                    </div>
                </div>
            </div>
        `;
        container.innerHTML += passengerHtml;
    });
    
    // Re-attach validation listeners
    attachValidationListeners();
}

// Attach validation listeners
function attachValidationListeners() {
    document.querySelectorAll('input, select').forEach(element => {
        element.addEventListener('input', validateForm);
        element.addEventListener('change', validateForm);
    });
}

// Form validation
function validateForm() {
    const continueBtn = document.getElementById('continue-btn');
    
    // Check all passenger inputs
    const passengerInputs = document.querySelectorAll('.passenger-input');
    const passengerCount = document.querySelectorAll('.passenger-item').length;
    
    let allPassengersValid = true;
    
    for (let i = 1; i <= passengerCount; i++) {
        const nameInput = document.querySelector(`input[placeholder="Name *"][data-passenger="${i}"]`);
        const ageInput = document.querySelector(`input[placeholder="Age *"][data-passenger="${i}"]`);
        const genderInputs = document.querySelectorAll(`input[name="gender${i}"]`);
        
        const isNameFilled = nameInput && nameInput.value.trim() !== '';
        const isAgeFilled = ageInput && ageInput.value.trim() !== '';
        const isGenderSelected = Array.from(genderInputs).some(input => input.checked);
        
        if (!isNameFilled || !isAgeFilled || !isGenderSelected) {
            allPassengersValid = false;
            break;
        }
    }
    
    // Check contact details
    const phoneInput = document.querySelector('input[placeholder="Phone *"]');
    const stateSelect = document.querySelector('select');
    
    const isPhoneFilled = phoneInput && phoneInput.value.trim() !== '';
    const isStateSelected = stateSelect && stateSelect.value !== '';
    
    if (allPassengersValid && isPhoneFilled && isStateSelected) {
        continueBtn.disabled = false;
        continueBtn.classList.remove('bg-gray-300');
        continueBtn.classList.add('bg-green-700');
    } else {
        continueBtn.disabled = true;
        continueBtn.classList.add('bg-gray-300');
        continueBtn.classList.remove('bg-green-700');
    }
}

// Go back function
function goBack() {
    window.history.back();
}

// Book ticket button
// Book ticket button - UPDATED VERSION
document.getElementById('continue-btn').addEventListener('click', function() {
    if (!this.disabled) {
        const urlParams = new URLSearchParams(window.location.search);

        // Get all existing booking details from URL
        const busName = urlParams.get('busName') || '';
        const busTime = urlParams.get('busTime') || '';
        const busType = urlParams.get('busType') || '';
        const selectedSeats = urlParams.get('selectedSeats') || '';
        const totalPrice = urlParams.get('totalPrice') || '';
        const fromCity = urlParams.get('fromCity') || '';
        const toCity = urlParams.get('toCity') || '';
        const boardingTime = urlParams.get('boardingTime') || '';
        const boardingLocation = urlParams.get('boardingLocation') || '';
        const boardingAddress = urlParams.get('boardingAddress') || '';
        const droppingTime = urlParams.get('droppingTime') || '';
        const droppingLocation = urlParams.get('droppingLocation') || '';
        const droppingAddress = urlParams.get('droppingAddress') || '';

        // NEW: Collect all passenger details
        const seats = selectedSeats.split(',').map(s => s.trim()).filter(s => s);
        const passengers = [];

        seats.forEach((seat, index) => {
            const passengerNumber = index + 1;
            const name = document.querySelector(`input[placeholder="Name *"][data-passenger="${passengerNumber}"]`)?.value || '';
            const age = document.querySelector(`input[placeholder="Age *"][data-passenger="${passengerNumber}"]`)?.value || '';
            const genderInput = document.querySelector(`input[name="gender${passengerNumber}"]:checked`);
            const gender = genderInput ? genderInput.value : '';

            passengers.push({
                name: name,
                age: age,
                gender: gender,
                seat: seat
            });
        });

        // Convert passengers array to JSON string
        const passengersJSON = JSON.stringify(passengers);

        // Get contact details
        const phone = document.querySelector('input[placeholder="Phone *"]')?.value || '';
        const email = document.querySelector('input[placeholder="Email ID"]')?.value || '';
        const state = document.querySelector('select')?.value || '';

        // Build URL for payment page with ALL data including passengers
        const paymentUrl = `payment.html?busName=${encodeURIComponent(busName)}&busTime=${encodeURIComponent(busTime)}&busType=${encodeURIComponent(busType)}&selectedSeats=${encodeURIComponent(selectedSeats)}&totalPrice=${encodeURIComponent(totalPrice)}&fromCity=${encodeURIComponent(fromCity)}&toCity=${encodeURIComponent(toCity)}&boardingTime=${encodeURIComponent(boardingTime)}&boardingLocation=${encodeURIComponent(boardingLocation)}&boardingAddress=${encodeURIComponent(boardingAddress)}&droppingTime=${encodeURIComponent(droppingTime)}&droppingLocation=${encodeURIComponent(droppingLocation)}&droppingAddress=${encodeURIComponent(droppingAddress)}&passengers=${encodeURIComponent(passengersJSON)}&phone=${encodeURIComponent(phone)}&email=${encodeURIComponent(email)}&state=${encodeURIComponent(state)}`;

        // Redirect to payment page
        window.location.href = paymentUrl;
    }
});

// Initialize page
document.addEventListener('DOMContentLoaded', function() {
    loadBookingData();
});

    </script>
</body>
</html>